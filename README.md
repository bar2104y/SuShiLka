# Sushilka

## Введение
Проект сушилки филамента для 3Д-принтера. Основной задачей является создание такой прошивки для сушилки, которая была бы максимально готова к применению любителями, не разбирающимися в программировании и электронике в целом, в то же время с сохранением возможности тонкой настройки прошивки под себя при необходимости.

За основу была взята отладочная плата NodeMCU V3 с микроконтроллером esp8266, так как на данный моемент (начало 2022 г.) такие платы стоят дешевле китайских arduino, при этом имеют модуль Wi-Fi на борту, что позволяет реализовать управление по воздуху.

На данный момент проект находится на стадии "вялой" разработки. Проект открт к развитию, с удовольствием приму любую помощь в программировании, отладке плат, прошивки, проектировании корпуса изделия итд. У меня времени не очень много(((

***

## Обзор возможностей
* Подержание заданной температуры в течении заданного времени
* Изменение продление сушки на ходу
* Использование встроенных комбинаций температура+время (3 слота)
* Максимальная поддерживаемая температура - *не тестировалась*
* Управление G-CODEом

***

## Состав электроники
* NodeMCU V3 (скорее всего подойдет любая отладочная плата на основе esp8266)
* Энкодер с кнопкой
* OLED дисплей 128х64
* Модуль реального времени на ds1307
* Твердотельное реле(максимальный ток выбирается исходя из требований нагревательного элемента)
* ???NTC термистор 10КОм
* ???Резистор 10КОм

***

## Используемые библиотеки
* Adafruit GFX Library (ver. 1.10.12)
* [Adafruit SSD1306](https://github.com/adafruit/Adafruit_SSD1306)
* DS1307 (ver. 1.4.1)
* [EncButton](https://github.com/GyverLibs/EncButton) (ver. 1.15.0)
* [GyverPID](https://github.com/GyverLibs/GyverPID) (ver. 3.3.0)

***

coming soon....

***

## Основные настройки
`#define SERIAL_SPEED 9600` - Скорость UART

Настройки экрана
```
#define SCREEN_WIDTH 128    // Ширина, пиксели
#define SCREEN_HEIGHT 64    // Высота, пиксели
#define OLED_RESET     -1   // Reset pin # (отключен: -1)
#define SCREEN_ADDRESS 0x3C // Адрес экрана (0x3C или 0x3D), смотреть DATASHEET
```

Настройки предельных температур, при выходе за которые сушилка уходит в ошибку
```
#define MIN_TEMP 0
#define MAX_TEMP 120
```

`#define DRAW_INFO_TO_SERIAL_MONITOR true` - Вывод графика температуры в UART порт `true` или `false`

Настройки программ сушки:
```
#define PROGRAM_1
#define PROGRAM_1_TITLE  "PLA"   // Название
#define PROGRAM_1_TEMP   50      // Температура
#define PROGRAM_1_TIME_D 0       // Время в днях
#define PROGRAM_1_TIME_H 3       // Время в часах
#define PROGRAM_1_TIME_M 0       // Время в минутах
#define PROGRAM_1_TIME_S 0       // Время в секундах
```

Доступно 3 программы:
```
#define PROGRAM_1
#define PROGRAM_2
#define PROGRAM_3
```

***

## Ближайшее развитие
* Перенос надроек в EEPROM
* Создание версии под другие датчики реального времени или для варианта без модулей реального времени (сейчас не восстановления после отключения, см пункт выше)
* Починка и настройка калибровки PID-регулятора
* Добавление команд управления через GCode
* Создание WEB-интерфейса
* Поиск багов


***

## История изменений
* **0.0.2**

   Реализовано управление нагревом без установки времени.

* **0.1.0**

    MWP
    
    Полностью изменена структура программы, почти вся логика работы заключена в классах `Controller` и `Interface`, вся логика находится в `Controller`, включая ввод данных, выдачу управляющих сигналов и команд на отображение информации, само отображение информации происходит через `Interface`, данные в который передаются при каждом вызове методов.

* **0.1.2**

   Незначительные улучшения прошивки, добавлена настройка ПИД-регулятора, но работает некорректно, сейчас ПИД отключен (kP=100, kI=kD=0). Протестировано на прототипе, сушка PLA 4 часа на 50 градусах.

* **0.1.4**

   Добавлено управление через G-Code (`M141 S[]` и `M75 D[] H[] M[] S[]`) по UART. В связи с переходом на печатные платы и NTC-термисторы, был добавлен класс `TemperatureNTC`, в следующей версии `TemperatureAnalog` будет заменен на `TemperaturePTC`.

   Исправлен плавающий баг с зависанием в режиме установки времени(при выходе из него).

   Главные недостатки на данный момент: "деление" энкодера (для перехода на следующую строку необходимо 3 щелчка). Необходимость наличия модуля реального времени, даже для того случая, когда можно обойтись без него, то есть, когда, не требуется восстановление после отключения. 
      